import{initializeApp}from"https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";import{getAnalytics}from"https://www.gstatic.com/firebasejs/9.8.3/firebase-analytics.js";import{delCookie,getCookie}from"./common_function.js";const firebaseConfig={apiKey:"AIzaSyDtTxfCIJIfPTEw44Ah5I1lpjiDO96FlJM",authDomain:"mydatabase-8f225.firebaseapp.com",databaseURL:"https://mydatabase-8f225-default-rtdb.firebaseio.com",projectId:"mydatabase-8f225",storageBucket:"mydatabase-8f225.appspot.com",messagingSenderId:"68532714578",appId:"1:68532714578:web:fc038b336827906b65338b",measurementId:"G-68RXLWEXS7"};firebase.initializeApp(firebaseConfig);var db=firebase.database(),user_account=document.querySelector(".user_account"),user_birthDate=document.querySelector(".user_birthDate"),user_gender=document.querySelector(".user_gender"),user_idCardNumber=document.querySelector(".user_idCardNumber"),user_realName=document.querySelector(".user_realName"),user_motorcycle=document.querySelector(".user_motorcycle"),user_referenceNumber=document.querySelector(".user_referenceNumber"),user_insuranceCompanyName=document.querySelector(".user_insuranceCompanyName");db.ref("/Users/"+getCookie("uid")).once("value",(function(e){var t=e.val();user_account.innerHTML=t.account,user_birthDate.innerHTML=t.birthDate,user_gender.innerHTML=t.gender,user_idCardNumber.innerHTML=t.idCardNumber,user_realName.innerHTML=t.realName,user_insuranceCompanyName.innerHTML=t.insuranceCompany.name,user_referenceNumber.innerHTML=t.referenceNumber}));var user_logout=document.querySelector(".user_logout");user_logout.addEventListener("click",(e=>{null!=getCookie("uid")&&(delCookie("uid"),document.cookie="LoginStatus=No",window.location="userLogin.html")})),null==getCookie("uid")&&(alert("您還沒有登入喔~\n即將跳轉回登入頁面!"),window.location="userLogin.html");var motorcycle_brand=document.getElementById("motorcycle_brand"),motorcycle_cc=document.getElementById("motorcycle_cc"),motorcycle_owner=document.getElementById("motorcycle_owner"),motorcycle_plateNumber=document.getElementById("motorcycle_plateNumber");document.querySelector("#user_motorcycle").addEventListener("click",(e=>{$("#motorcycle_detail").dialog({width:320,height:280,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}),db.ref("/Users/"+getCookie("uid")).once("value",(function(e){var t=e.val().motorcycle;motorcycle_brand.innerHTML=t.brand,motorcycle_cc.innerHTML=t.cc,motorcycle_owner.innerHTML=t.owner,motorcycle_plateNumber.innerHTML=t.plateNumber})),$("#motorcycle_detail").show()}));var row='\n        <td id="journey-title"></td>\n        <td id="acceleration_stat"></td>\n        <td id="distance_stat"><a href="#">Click me</a></td>\n        <td id="gps_stat"><a href="#">Click me</a></td>\n        <td id="journey-detail"><a href="#">Click me</a></td>\n        ';function showweek(e){return 0==e.getDay()?"星期日":1==e.getDay()?"星期一":2==e.getDay()?"星期二":3==e.getDay()?"星期三":4==e.getDay()?"星期四":5==e.getDay()?"星期五":6==e.getDay()?"星期六":void 0}function showdate(e){var t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),r=e.getHours(),n=e.getMinutes();return r<10&&(r="0"+r),n<10&&(n="0"+n),t+"年"+a+"月"+i+"日 "+showweek(e)+" "+r+":"+n}function isNumeric(e){return!isNaN(e)}db.ref("/Users/"+getCookie("uid")).once("value",(function(e){for(var t=e.val(),a=0,i=0;i<Object.keys(t.journey).length;i++)isNumeric(Object.keys(t.journey)[i])&&(a+=1);if(0==a){var r=document.querySelector(".journey-table-tbody");row='<tr> \n                <td id="journey-title">查無資料</td>\n                <td id="acceleration_stat">查無資料</td>\n                <td id="distance_stat">查無資料</td>\n                <td id="gps_stat">查無資料</td>\n                <td id="journey-detail">查無資料</td>\n            </tr>',r.insertAdjacentHTML("afterbegin",row),$(".loader-wrapper").fadeOut("slow")}if(a>0){r=document.querySelector(".journey-table-tbody");for(var n=t.journey,d=0;d<a;d++)row='\n                <td id="journey-title">'+n[Object.keys(n)[d]].start_time+'</td>\n                <td id="acceleration_stat"><a id="journey_'+n[Object.keys(n)[d]].start_time+'">點擊查看</a></td>\n                <td id="distance_stat"><a id="journey_'+n[Object.keys(n)[d]].start_time+'">點擊查看</a></td>\n                <td id="gps_stat"><a id="journey_'+n[Object.keys(n)[d]].start_time+'">點擊查看</a></td>\n                <td id="journey-detail"><a id="journey_'+n[Object.keys(n)[d]].start_time+'">點擊查看</a></td>\n            ',r.insertAdjacentHTML("afterbegin",row),document.querySelector("td#journey-detail a#journey_"+String(n[Object.keys(n)[d]].start_time)).addEventListener("click",(e=>{$("#journey-modal").dialog({width:400,height:250,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}),$("#journey-modal").show();var t=document.getElementById("data-journey-start"),a=document.getElementById("data-journey-end"),i=document.getElementById("data-journey-totaltime"),r=document.getElementById("data-journey-safetyScore"),d=showdate(new Date(1e3*n[String(e.target.id.substring(8))].start_time)),o=showdate(new Date(1e3*n[String(e.target.id.substring(8))].end_time)),s=n[String(e.target.id.substring(8))].journey_time;t.innerHTML=d,a.innerHTML=o,i.innerHTML=s+"秒",null!=n[String(e.target.id.substring(8))].safety_score&&(r.innerHTML=n[String(e.target.id.substring(8))].safety_score+"分")})),document.querySelector("td#distance_stat a#journey_"+String(n[Object.keys(n)[d]].start_time)).addEventListener("click",(e=>{$("#distance-modal").dialog({width:420,height:250,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}),$("#distance-modal").show();var t=document.getElementById("data-left-distance"),a=document.getElementById("data-right-distance"),i=document.getElementById("data-back-distance"),r=n[String(e.target.id.substring(8))].distance_stat[0].avg_distance,d=n[String(e.target.id.substring(8))].distance_stat[1].avg_distance,o=n[String(e.target.id.substring(8))].distance_stat[2].avg_distance;if(t.innerHTML=r+" mm",a.innerHTML=d+" mm",i.innerHTML=o+" mm",null!=n[String(e.target.id.substring(8))].distance_stat[0].distance_violation){var s=document.querySelector("#distance-modal div#violation_1"),l=1;null==document.querySelector("table#violation1_"+String(e.target.id.substring(8)))&&(s.innerHTML='<table id="violation1_'+String(e.target.id.substring(8))+'" style="border: 1px solid black;text-align: center;"><p style="margin-top: 20px;">左方車距違規資訊:</p><tr style="border: 1px solid black;"><th style="border: 1px solid black;padding: 5px;">違規編號</th><th style="border: 1px solid black;padding: 5px;">違規車距差</th></tr></table>',n[String(e.target.id.substring(8))].distance_stat[0].distance_violation.forEach((t=>{document.querySelector("table#violation1_"+String(e.target.id.substring(8))).innerHTML+='<tr style="border: 1px solid black;"><td style="border: 1px solid black;padding: 5px;" id="data-left-distance">'+l+'</td><td style="border: 1px solid black;padding: 5px;" id="data-right-distance">'+t+" mm</td></tr>",l+=1})))}null==n[String(e.target.id.substring(8))].distance_stat[0].distance_violation&&((s=document.querySelector("#distance-modal div#violation_1")).innerHTML="");if(null!=n[String(e.target.id.substring(8))].distance_stat[1].distance_violation){var s=document.querySelector("#distance-modal div#violation_2");l=1;null==document.querySelector("table#violation2_"+String(e.target.id.substring(8)))&&(s.innerHTML='<table id="violation2_'+String(e.target.id.substring(8))+'" style="border: 1px solid black;text-align: center;"><p style="margin-top: 20px;">右方車距違規資訊:</p><tr style="border: 1px solid black;"><th style="border: 1px solid black;padding: 5px;">違規編號</th><th style="border: 1px solid black;padding: 5px;">違規車距差</th></tr></table>',n[String(e.target.id.substring(8))].distance_stat[1].distance_violation.forEach((t=>{document.querySelector("table#violation2_"+String(e.target.id.substring(8))).innerHTML+='<tr style="border: 1px solid black;"><td style="border: 1px solid black;padding: 5px;" id="data-left-distance">'+l+'</td><td style="border: 1px solid black;padding: 5px;" id="data-right-distance">'+t+" mm</td></tr>",l+=1})))}null==n[String(e.target.id.substring(8))].distance_stat[1].distance_violation&&((s=document.querySelector("#distance-modal div#violation_2")).innerHTML="");if(null!=n[String(e.target.id.substring(8))].distance_stat[2].distance_violation){s=document.querySelector("#distance-modal div#violation_3"),l=1;null==document.querySelector("table#violation3_"+String(e.target.id.substring(8)))&&(s.innerHTML='<table id="violation3_'+String(e.target.id.substring(8))+'" style="border: 1px solid black;text-align: center;"><p style="margin-top: 20px;">後方車距違規資訊:</p><tr style="border: 1px solid black;"><th style="border: 1px solid black;padding: 5px;">違規編號</th><th style="border: 1px solid black;padding: 5px;">違規車距差</th></tr></table>',n[String(e.target.id.substring(8))].distance_stat[2].distance_violation.forEach((t=>{document.querySelector("table#violation3_"+String(e.target.id.substring(8))).innerHTML+='<tr style="border: 1px solid black;"><td style="border: 1px solid black;padding: 5px;" id="data-left-distance">'+l+'</td><td style="border: 1px solid black;padding: 5px;" id="data-right-distance">'+t+" mm</td></tr>",l+=1})))}null==n[String(e.target.id.substring(8))].distance_stat[2].distance_violation&&((s=document.querySelector("#distance-modal div#violation_3")).innerHTML="")})),document.querySelector("td#acceleration_stat a#journey_"+String(n[Object.keys(n)[d]].start_time)).addEventListener("click",(e=>{$("#acceleration-modal").dialog({width:300,height:250,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}),$("#acceleration-modal").show();var t=document.getElementById("avg_acceleration"),a=document.getElementById("avg_gyro"),i=(Math.round(1e3*n[String(e.target.id.substring(8))].acceleration_stat[0].avg_acceleration)/1e3).toFixed(3),r=(Math.round(1e3*n[String(e.target.id.substring(8))].acceleration_stat[1].avg_gyro)/1e3).toFixed(3);if(t.innerHTML=i,a.innerHTML=r,null!=n[String(e.target.id.substring(8))].acceleration_stat[0].acceleration_violation){var d=document.querySelector("#acceleration-modal div#violation_1"),o=1;null==document.querySelector("table#acceleration_violation1_"+String(e.target.id.substring(8)))&&(d.innerHTML='<table id="acceleration_violation1_'+String(e.target.id.substring(8))+'" style="border: 1px solid black;text-align: center;"><p style="margin-top: 20px;">加速度違規資訊:</p><tr style="border: 1px solid black;"><th style="border: 1px solid black;padding: 5px;">違規編號</th><th style="border: 1px solid black;padding: 5px;">違規加速度差</th></tr></table>',n[String(e.target.id.substring(8))].acceleration_stat[0].acceleration_violation.forEach((t=>{document.querySelector("table#acceleration_violation1_"+String(e.target.id.substring(8))).innerHTML+='<tr style="border: 1px solid black;"><td style="border: 1px solid black;padding: 5px;" id="data-left-distance">'+o+'</td><td style="border: 1px solid black;padding: 5px;" id="data-right-distance">'+(Math.round(1e3*t)/1e3).toFixed(3),o+=1})))}null==n[String(e.target.id.substring(8))].acceleration_stat[0].acceleration_violation&&((d=document.querySelector("#acceleration-modal div#violation_1")).innerHTML="")})),document.querySelector("td#gps_stat a#journey_"+String(n[Object.keys(n)[d]].start_time)).addEventListener("click",(e=>{$("#speed-modal").dialog({width:500,height:250,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}),$("#speed-modal").show();var t=document.getElementById("avg_speed"),a=(Math.round(1e3*n[String(e.target.id.substring(8))].speed_stat.avg_speed)/1e3).toFixed(2);if(t.innerHTML=a+" km/hr",null!=n[String(e.target.id.substring(8))].speed_stat.speed_violation){var i=document.querySelector("#speed-modal div#violation_1"),r=1;null==document.querySelector("table#speed_violation1_"+String(e.target.id.substring(8)))&&(i.innerHTML='<table id="speed_violation1_'+String(e.target.id.substring(8))+'" style="border: 1px solid black;text-align: center;"><p style="margin-top: 20px;">速度違規資訊:</p><tr style="border: 1px solid black;"><th style="border: 1px solid black;padding: 5px;">違規編號</th><th style="border: 1px solid black;padding: 5px;">道路名稱</th><th style="border: 1px solid black;padding: 5px;">車速</th><th style="border: 1px solid black;padding: 5px;">道路速限</th></tr></table>',n[String(e.target.id.substring(8))].speed_stat.speed_violation.forEach((t=>{var a=document.querySelector("table#speed_violation1_"+String(e.target.id.substring(8)));isNumeric(String(t.road).split(",")[0])&&(a.innerHTML+='<tr style="border: 1px solid black;"><td style="border: 1px solid black;padding: 5px;">'+r+'</td><td style="border: 1px solid black;padding: 5px;">經度: '+String(t.road).split(",")[0]+"<br>緯度: "+String(t.road).split(",")[1]+'</td><td style="border: 1px solid black;padding: 5px;">'+(Math.round(1e3*t.speed)/1e3).toFixed(2)+' km/hr</td><td style="border: 1px solid black;padding: 5px;">'+(Math.round(1e3*t.speed_limit)/1e3).toFixed(0)+" km/hr</td></tr>"),isNumeric(String(t.road).split(",")[0])||(a.innerHTML+='<tr style="border: 1px solid black;"><td style="border: 1px solid black;padding: 5px;">'+r+'</td><td style="border: 1px solid black;padding: 5px;">'+t.road+'</td><td style="border: 1px solid black;padding: 5px;">'+(Math.round(1e3*t.speed)/1e3).toFixed(2)+' km/hr</td><td style="border: 1px solid black;padding: 5px;">'+(Math.round(1e3*t.speed_limit)/1e3).toFixed(0)+" km/hr</td></tr>"),r+=1})))}null==n[String(e.target.id.substring(8))].speed_stat.speed_violation&&((i=document.querySelector("#speed-modal div#violation_1")).innerHTML="")}));if($("#table-demo tbody tr").length==a){var o=0;$("#table-demo").after('<div id="nav"><ul class="pagination"></ul></div>');var s=$("#table-demo tbody tr").length/5;for(d=0;d<s;d++){var l=d+1;$("#nav .pagination").append('<li class="page-item normal-page-item"><a class="page-link normalLink link'+d+'" rel="'+d+'">'+l+"</a></li>")}$("#nav .pagination").prepend('<li class="page-item special-page-item"><a class="page-link lastPage" rel="0" aria-label="Previous"><span aria-hidden="true">&laquo;</span><span class="sr-only">Previous</span></a></li>'),$("#nav .pagination").append('<li class="page-item special-page-item"><a class="page-link nextPage" aria-label="Next"><span aria-hidden="true">&raquo;</span><span class="sr-only">Next</span></a></li>'),$("#table-demo tbody tr").hide(),$("#table-demo tbody tr").slice(0,5).show(),$("#nav a.normalLink:first").addClass("active"),Number(o)-1<=0&&$("#nav .pagination li.normal-page-item").css("opacity","0.0").hide().slice(o,o+3).show().css("opacity","1.0"),$("#nav a.normalLink").bind("click",(function(){$("#nav a").removeClass("active"),$(this).addClass("active");var e=$(this).attr("rel");o=$(this).attr("rel");var t=5*e,a=t+5;$("#table-demo tbody tr").css("opacity","0.0").hide().slice(t,a).css("display","table-row").animate({opacity:1},300),Math.round(s)>=3&&(Number(o)-1<=0&&$("#nav .pagination li.normal-page-item").css("opacity","0.0").hide().slice(o,o+3).show().css("opacity","1.0"),Number(o)==Math.round(s)-1&&$("#nav .pagination li.normal-page-item").css("opacity","0.0").hide().slice(o-2,Number(o)+1).show().css("opacity","1.0"),Number(o)-1>=0&Number(o)!=Math.round(s)-1&&$("#nav .pagination li.normal-page-item").css("opacity","0.0").hide().slice(o-1,Number(o)+2).show().css("opacity","1.0"))})),$("#nav a.lastPage").bind("click",(function(){$("#nav a.normalLink").removeClass("active"),$("#nav a.lastPage").removeClass("active"),$("#nav a.nextPage").removeClass("active"),o-1>=0?$(this).attr("rel",o-1):$(this).attr("rel",0);var e=$(this).attr("rel");o=$(this).attr("rel");var t=5*e,a=t+5;$("#table-demo tbody tr").css("opacity","0.0").hide().slice(t,a).css("display","table-row").animate({opacity:1},300);for(var i=0;i<s;i++)i==Number(o)?$("#nav .pagination li.normal-page-item a.link"+String(i)).addClass("active"):$("#nav .pagination li.normal-page-item a.link"+String(i)).removeClass("active");Math.round(s)>=3&&(Number(o)-1<=0&&$("#nav .pagination li.normal-page-item").css("opacity","0.0").hide().slice(o,o+3).show().css("opacity","1.0"),Number(o)==s-1&&$("#nav .pagination li.normal-page-item").css("opacity","0.0").hide().slice(o-2,Number(o)+1).show().css("opacity","1.0"),Number(o)-1>=0&Number(o)!=s-1&&$("#nav .pagination li.normal-page-item").css("opacity","0.0").hide().slice(o-1,Number(o)+2).show().css("opacity","1.0"))})),$("#nav a.nextPage").bind("click",(function(){$("#nav a.normalLink").removeClass("active"),$("#nav a.lastPage").removeClass("active"),$("#nav a.nextPage").removeClass("active"),$(this).addClass("active"),Number(o)+1<s?$(this).attr("rel",Number(o)+1):$(this).attr("rel",o);var e=$(this).attr("rel");o=$(this).attr("rel");var t=5*e,a=t+5;$("#table-demo tbody tr").css("opacity","0.0").hide().slice(t,a).css("display","table-row").animate({opacity:1},300);for(var i=0;i<s;i++)i==Number(o)?$("#nav .pagination li.normal-page-item a.link"+String(i)).addClass("active"):$("#nav .pagination li.normal-page-item a.link"+String(i)).removeClass("active");$("#nav a.nextPage").removeClass("active"),Math.round(s)>=3&&(Number(o)+1==Math.round(s)&&$("#nav .pagination li.normal-page-item").css("opacity","0.0").hide().slice(o-2,o+1).show().css("opacity","1.0"),Number(o)+1<Math.round(s)&&$("#nav .pagination li.normal-page-item").css("opacity","0.0").hide().slice(o-1,Number(o)+2).show().css("opacity","1.0"))}))}$(".loader-wrapper").fadeOut("slow"),$("#nav a.normalLink").first().click()}})),$(".navbar-toggler").bind("click",(function(e){$("div.navbar-collapse").slideToggle(500)}));