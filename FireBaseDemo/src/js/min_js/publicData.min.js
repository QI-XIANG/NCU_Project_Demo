import{initializeApp}from"https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";import{getAnalytics}from"https://www.gstatic.com/firebasejs/9.8.3/firebase-analytics.js";import{switchChart,hideAllGraph,isNumeric,showdate,getCookie}from"./common_function.js";const firebaseConfig={apiKey:"AIzaSyDtTxfCIJIfPTEw44Ah5I1lpjiDO96FlJM",authDomain:"mydatabase-8f225.firebaseapp.com",databaseURL:"https://mydatabase-8f225-default-rtdb.firebaseio.com",projectId:"mydatabase-8f225",storageBucket:"mydatabase-8f225.appspot.com",messagingSenderId:"68532714578",appId:"1:68532714578:web:55ae248480d4ea0a65338b",measurementId:"G-0H2LVBE185"};firebase.initializeApp(firebaseConfig);const sum=a=>a.reduce(((a,e)=>a+e),0),average=a=>a.reduce(((a,e)=>a+e),0)/a.length;var color1=["#FF0000","#F97600","#F6C600","#60B044"],color2=["#60B044","#F6C600","#F97600","#FF0000"],speed_avg=[],speed_v=[],acc_avg=[],acc_avg_g=[],acc_v=[],gyro_avg=[],left_avg=[],left_v=[],right_avg=[],right_v=[],back_avg=[],back_v=[],journey_time=[],score=[],score_fail=[],score_pass=[],db=firebase.database();function donutChart(a,e,t,r,o,c,g,i){c3.generate({bindto:a,data:{columns:[[e,t],[r,o],[c,g]],type:"donut"},donut:{title:i},size:{height:320}})}function donutChart_safety(a,e,t,r,o,c){c3.generate({bindto:a,data:{columns:[[e,t],[r,o]],type:"donut"},donut:{title:c},size:{height:320}})}function gauge_chart(a,e,t,r,o,c,g){c3.generate({bindto:a,data:{columns:[[e,t]],type:"gauge"},gauge:{label:{format:function(a,e){return a+c}},min:r,max:o},color:{pattern:g,threshold:{values:[.5*o,.7*o,.8*o,o]}},size:{height:200}})}db.ref("/OpenData/").once("value",(function(a){var e=a.val();e=a.val();speed_avg=e.speed_avg,speed_v=e.speed_v,(acc_avg=e.acc_avg).forEach((a=>{a*=9.8,acc_avg_g.push(a)})),acc_v=e.acc_v,gyro_avg=e.gyro_avg,left_avg=e.left_avg,left_v=e.left_v,right_avg=e.right_avg,right_v=e.right_v,back_avg=e.back_avg,back_v=e.back_v,journey_time=e.journey_time,(score=e.score).forEach((a=>{a>=60?score_pass.push(a):score_fail.push(a)})),donutChart("#chart","速度違規",sum(speed_v),"加速度違規",sum(acc_v),"車距違規",sum(left_v)+sum(right_v)+sum(back_v),"各類違規"),donutChart("#chart2","左方車距違規",sum(left_v),"右方車距違規",sum(right_v),"後方車距違規",sum(back_v),"車距違規"),donutChart_safety("#chart3","安全分數高於60分",score_pass.length,"安全分數低於60分",score_fail.length,"安全分數"),gauge_chart("#chart4","平均速度",average(speed_avg).toFixed(0),Math.min(...speed_avg).toFixed(0),Math.max(...speed_avg).toFixed(0)," km/hr",color2),gauge_chart("#chart5","平均加速度",average(acc_avg_g).toFixed(2),Math.min(...acc_avg_g).toFixed(2),Math.max(...acc_avg_g).toFixed(2)," m/s²",color2),gauge_chart("#chart6","平均角加速度",average(gyro_avg).toFixed(2),Math.min(...gyro_avg).toFixed(2),Math.max(...gyro_avg).toFixed(2),"°/s²",color2),gauge_chart("#chart7","平均左方車距",average(left_avg).toFixed(0),Math.min(...left_avg).toFixed(0),Math.max(...left_avg).toFixed(0)," mm",color1),gauge_chart("#chart8","平均右方車距",average(right_avg).toFixed(0),Math.min(...right_avg).toFixed(0),Math.max(...right_avg).toFixed(0)," mm",color1),gauge_chart("#chart9","平均後方車距",average(back_avg).toFixed(0),Math.min(...back_avg).toFixed(0),Math.max(...back_avg).toFixed(0)," mm",color1),gauge_chart("#chart10","平均安全分數",average(score).toFixed(0),Math.min(...score).toFixed(0),Math.max(...score).toFixed(0)," 分",color1),$(".loader-wrapper").fadeOut("slow")}));