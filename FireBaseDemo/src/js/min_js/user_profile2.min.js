import{initializeApp}from"https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";import{getAnalytics}from"https://www.gstatic.com/firebasejs/9.8.3/firebase-analytics.js";import{delCookie,getCookie}from"./common_function.js";const firebaseConfig={apiKey:"AIzaSyDtTxfCIJIfPTEw44Ah5I1lpjiDO96FlJM",authDomain:"mydatabase-8f225.firebaseapp.com",databaseURL:"https://mydatabase-8f225-default-rtdb.firebaseio.com",projectId:"mydatabase-8f225",storageBucket:"mydatabase-8f225.appspot.com",messagingSenderId:"68532714578",appId:"1:68532714578:web:fc038b336827906b65338b",measurementId:"G-68RXLWEXS7"};firebase.initializeApp(firebaseConfig);var db=firebase.database(),user_account=document.querySelector(".user_account"),user_birthDate=document.querySelector(".user_birthDate"),user_gender=document.querySelector(".user_gender"),user_idCardNumber=document.querySelector(".user_idCardNumber"),user_realName=document.querySelector(".user_realName"),user_motorcycle=document.querySelector(".user_motorcycle"),user_referenceNumber=document.querySelector(".user_referenceNumber"),user_insuranceCompanyName=document.querySelector(".user_insuranceCompanyName");db.ref("/Users/"+getCookie("uid")).once("value",(function(e){var t=e.val();user_account.innerHTML=t.account,user_birthDate.innerHTML=t.birthDate,user_gender.innerHTML=t.gender,user_idCardNumber.innerHTML=t.idCardNumber,user_realName.innerHTML=t.realName,user_insuranceCompanyName.innerHTML=t.insuranceCompany.name,user_referenceNumber.innerHTML=t.referenceNumber}));var user_logout=document.querySelector(".user_logout");user_logout.addEventListener("click",(e=>{null!=getCookie("uid")&&(delCookie("uid"),document.cookie="LoginStatus=No",window.location="userLogin.html")})),null==getCookie("uid")&&(alert("您還沒有登入喔~\n即將跳轉回登入頁面!"),window.location="userLogin.html");var motorcycle_brand=document.getElementById("motorcycle_brand"),motorcycle_cc=document.getElementById("motorcycle_cc"),motorcycle_owner=document.getElementById("motorcycle_owner"),motorcycle_plateNumber=document.getElementById("motorcycle_plateNumber");document.querySelector("#user_motorcycle").addEventListener("click",(e=>{$("#motorcycle_detail").dialog({width:320,height:280,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}),db.ref("/Users/"+getCookie("uid")).once("value",(function(e){var t=e.val().motorcycle;motorcycle_brand.innerHTML=t.brand,motorcycle_cc.innerHTML=t.cc,motorcycle_owner.innerHTML=t.owner,motorcycle_plateNumber.innerHTML=t.plateNumber})),$("#motorcycle_detail").show()}));var row='\n        <td id="journey-title"></td>\n        <td id="acceleration_stat"></td>\n        <td id="distance_stat"><a href="#">Click me</a></td>\n        <td id="gps_stat"><a href="#">Click me</a></td>\n        <td id="journey-detail"><a href="#">Click me</a></td>\n        ';function showeek(e){return 0==e.getDay()?"星期日":1==e.getDay()?"星期一":2==e.getDay()?"星期二":3==e.getDay()?"星期三":4==e.getDay()?"星期四":5==e.getDay()?"星期五":6==e.getDay()?"星期六":void 0}function showdate(e){var t=e.getFullYear(),r=e.getMonth()+1,i=e.getDate(),a=e.getHours(),d=e.getMinutes();return a<10&&(a="0"+a),d<10&&(d="0"+d),i<10&&(i="0"+i),r<10&&(r="0"+r),t+"年"+r+"月"+i+"日 "+showeek(e)+" "+a+":"+d}function isNumeric(e){return!isNaN(e)}function download_journey(e,t){var r="text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t[String(e.id).substring(8)]));e.setAttribute("href","data:"+r),e.setAttribute("download","data.json")}db.ref("/Users/"+getCookie("uid")).once("value",(function(e){for(var t=e.val(),r=0,i=0;i<Object.keys(t.journey).length;i++)isNumeric(Object.keys(t.journey)[i])&&(r+=1);if(0==r){var a=document.querySelector(".journey-table-tbody");row='<tr> \n                    <td id="journey_start_time">查無資料</td>\n                    <td id="acceleration_stat">查無資料</td>\n                    <td id="distance_stat">查無資料</td>\n                    <td id="gps_stat">查無資料</td>\n                    <td id="journey_pass_time">查無資料</td>\n                    <td id="journey_safety_score">查無資料</td>\n                </tr>',a.insertAdjacentHTML("afterbegin",row),$(".loader-wrapper").fadeOut("slow")}if(r>0){a=document.querySelector(".journey-table-tbody");for(var d=t.journey,n=0;n<r;n++)row='\n                <td id="journey_start_time">'+showdate(new Date(1e3*d[Object.keys(d)[n]].start_time))+'</td>\n                <td id="acceleration_stat"><a id="journey_'+d[Object.keys(d)[n]].start_time+'">點擊查看</a></td>\n                <td id="distance_stat"><a id="journey_'+d[Object.keys(d)[n]].start_time+'">點擊查看</a></td>\n                <td id="gps_stat"><a id="journey_'+d[Object.keys(d)[n]].start_time+'">點擊查看</a></td>\n                <td id="journey_pass_time">'+d[Object.keys(d)[n]].journey_time+' 秒</td>\n                <td id="journey_safety_score">'+d[Object.keys(d)[n]].safety_score+' 分</td>\n                <td id="journey_download"><a id="journey_'+d[Object.keys(d)[n]].start_time+'">點擊下載</a></td>\n            ',a.insertAdjacentHTML("afterbegin",row),document.querySelector("td#distance_stat a#journey_"+String(d[Object.keys(d)[n]].start_time)).addEventListener("click",(e=>{$("#distance-modal").dialog({width:420,height:250,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}),$("#distance-modal").show();var t=document.getElementById("data-left-distance"),r=document.getElementById("data-right-distance"),i=document.getElementById("data-back-distance"),a=d[String(e.target.id.substring(8))].distance_stat[0].avg_distance,n=d[String(e.target.id.substring(8))].distance_stat[1].avg_distance,o=d[String(e.target.id.substring(8))].distance_stat[2].avg_distance;if(t.innerHTML=a+" mm",r.innerHTML=n+" mm",i.innerHTML=o+" mm",null!=d[String(e.target.id.substring(8))].distance_stat[0].distance_violation){var s=document.querySelector("#distance-modal div#violation_1"),l=1;null==document.querySelector("table#violation1_"+String(e.target.id.substring(8)))&&(s.innerHTML='<table id="violation1_'+String(e.target.id.substring(8))+'" style="border: 1px solid black;text-align: center;"><p style="margin-top: 20px;">左方車距違規資訊:</p><tr style="border: 1px solid black;"><th style="border: 1px solid black;padding: 5px;">違規編號</th><th style="border: 1px solid black;padding: 5px;">違規車距差</th></tr></table>',d[String(e.target.id.substring(8))].distance_stat[0].distance_violation.forEach((t=>{document.querySelector("table#violation1_"+String(e.target.id.substring(8))).innerHTML+='<tr style="border: 1px solid black;"><td style="border: 1px solid black;padding: 5px;" id="data-left-distance">'+l+'</td><td style="border: 1px solid black;padding: 5px;" id="data-right-distance">'+t+" mm</td></tr>",l+=1})))}null==d[String(e.target.id.substring(8))].distance_stat[0].distance_violation&&((s=document.querySelector("#distance-modal div#violation_1")).innerHTML="");if(null!=d[String(e.target.id.substring(8))].distance_stat[1].distance_violation){var s=document.querySelector("#distance-modal div#violation_2");l=1;null==document.querySelector("table#violation2_"+String(e.target.id.substring(8)))&&(s.innerHTML='<table id="violation2_'+String(e.target.id.substring(8))+'" style="border: 1px solid black;text-align: center;"><p style="margin-top: 20px;">右方車距違規資訊:</p><tr style="border: 1px solid black;"><th style="border: 1px solid black;padding: 5px;">違規編號</th><th style="border: 1px solid black;padding: 5px;">違規車距差</th></tr></table>',d[String(e.target.id.substring(8))].distance_stat[1].distance_violation.forEach((t=>{document.querySelector("table#violation2_"+String(e.target.id.substring(8))).innerHTML+='<tr style="border: 1px solid black;"><td style="border: 1px solid black;padding: 5px;" id="data-left-distance">'+l+'</td><td style="border: 1px solid black;padding: 5px;" id="data-right-distance">'+t+" mm</td></tr>",l+=1})))}null==d[String(e.target.id.substring(8))].distance_stat[1].distance_violation&&((s=document.querySelector("#distance-modal div#violation_2")).innerHTML="");if(null!=d[String(e.target.id.substring(8))].distance_stat[2].distance_violation){s=document.querySelector("#distance-modal div#violation_3"),l=1;null==document.querySelector("table#violation3_"+String(e.target.id.substring(8)))&&(s.innerHTML='<table id="violation3_'+String(e.target.id.substring(8))+'" style="border: 1px solid black;text-align: center;"><p style="margin-top: 20px;">後方車距違規資訊:</p><tr style="border: 1px solid black;"><th style="border: 1px solid black;padding: 5px;">違規編號</th><th style="border: 1px solid black;padding: 5px;">違規車距差</th></tr></table>',d[String(e.target.id.substring(8))].distance_stat[2].distance_violation.forEach((t=>{document.querySelector("table#violation3_"+String(e.target.id.substring(8))).innerHTML+='<tr style="border: 1px solid black;"><td style="border: 1px solid black;padding: 5px;" id="data-left-distance">'+l+'</td><td style="border: 1px solid black;padding: 5px;" id="data-right-distance">'+t+" mm</td></tr>",l+=1})))}null==d[String(e.target.id.substring(8))].distance_stat[2].distance_violation&&((s=document.querySelector("#distance-modal div#violation_3")).innerHTML="")})),document.querySelector("td#acceleration_stat a#journey_"+String(d[Object.keys(d)[n]].start_time)).addEventListener("click",(e=>{$("#acceleration-modal").dialog({width:300,height:250,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}),$("#acceleration-modal").show();var t=document.getElementById("avg_acceleration"),r=document.getElementById("avg_gyro"),i=(Math.round(9800*d[String(e.target.id.substring(8))].acceleration_stat[0].avg_acceleration)/1e3).toFixed(2)+" m/s&#178;",a=(Math.round(1e3*d[String(e.target.id.substring(8))].acceleration_stat[1].avg_gyro)/1e3).toFixed(2)+"&#176;/s&#178;";if(t.innerHTML=i,r.innerHTML=a,null!=d[String(e.target.id.substring(8))].acceleration_stat[0].acceleration_violation){var n=document.querySelector("#acceleration-modal div#violation_1"),o=1;null==document.querySelector("table#acceleration_violation1_"+String(e.target.id.substring(8)))&&(n.innerHTML='<table id="acceleration_violation1_'+String(e.target.id.substring(8))+'" style="border: 1px solid black;text-align: center;"><p style="margin-top: 20px;">加速度違規資訊:</p><tr style="border: 1px solid black;"><th style="border: 1px solid black;padding: 5px;">違規編號</th><th style="border: 1px solid black;padding: 5px;">違規加速度</th></tr></table>',d[String(e.target.id.substring(8))].acceleration_stat[0].acceleration_violation.forEach((t=>{document.querySelector("table#acceleration_violation1_"+String(e.target.id.substring(8))).innerHTML+='<tr style="border: 1px solid black;"><td style="border: 1px solid black;padding: 5px;" id="data-left-distance">'+o+'</td><td style="border: 1px solid black;padding: 5px;" id="data-right-distance">'+(Math.round(9800*t)/1e3).toFixed(2)+" m/s&#178;</td></tr>",o+=1})))}null==d[String(e.target.id.substring(8))].acceleration_stat[0].acceleration_violation&&((n=document.querySelector("#acceleration-modal div#violation_1")).innerHTML="")})),document.querySelector("td#gps_stat a#journey_"+String(d[Object.keys(d)[n]].start_time)).addEventListener("click",(e=>{$("#speed-modal").dialog({width:500,height:250,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}),$("#speed-modal").show();var t=document.getElementById("avg_speed"),r=(Math.round(1e3*d[String(e.target.id.substring(8))].speed_stat.avg_speed)/1e3).toFixed(2);if(t.innerHTML=r+" km/hr",null!=d[String(e.target.id.substring(8))].speed_stat.speed_violation){var i=document.querySelector("#speed-modal div#violation_1"),a=1;null==document.querySelector("table#speed_violation1_"+String(e.target.id.substring(8)))&&(i.innerHTML='<table id="speed_violation1_'+String(e.target.id.substring(8))+'" style="border: 1px solid black;text-align: center;"><p style="margin-top: 20px;">速度違規資訊:</p><tr style="border: 1px solid black;"><th style="border: 1px solid black;padding: 5px;">違規編號</th><th style="border: 1px solid black;padding: 5px;">道路名稱</th><th style="border: 1px solid black;padding: 5px;">車速</th><th style="border: 1px solid black;padding: 5px;">道路速限</th></tr></table>',d[String(e.target.id.substring(8))].speed_stat.speed_violation.forEach((t=>{var r=document.querySelector("table#speed_violation1_"+String(e.target.id.substring(8)));isNumeric(String(t.road).split(",")[0])&&(r.innerHTML+='<tr style="border: 1px solid black;"><td style="border: 1px solid black;padding: 5px;">'+a+'</td><td style="border: 1px solid black;padding: 5px;">經度: '+String(t.road).split(",")[0]+"<br>緯度: "+String(t.road).split(",")[1]+'</td><td style="border: 1px solid black;padding: 5px;">'+(Math.round(1e3*t.speed)/1e3).toFixed(2)+' km/hr</td><td style="border: 1px solid black;padding: 5px;">'+(Math.round(1e3*t.speed_limit)/1e3).toFixed(0)+" km/hr</td></tr>"),isNumeric(String(t.road).split(",")[0])||(r.innerHTML+='<tr style="border: 1px solid black;"><td style="border: 1px solid black;padding: 5px;">'+a+'</td><td style="border: 1px solid black;padding: 5px;">'+t.road+'</td><td style="border: 1px solid black;padding: 5px;">'+(Math.round(1e3*t.speed)/1e3).toFixed(2)+' km/hr</td><td style="border: 1px solid black;padding: 5px;">'+(Math.round(1e3*t.speed_limit)/1e3).toFixed(0)+" km/hr</td></tr>"),a+=1})))}null==d[String(e.target.id.substring(8))].speed_stat.speed_violation&&((i=document.querySelector("#speed-modal div#violation_1")).innerHTML="")})),document.querySelector("td#journey_download #journey_"+String(d[Object.keys(d)[n]].start_time)).addEventListener("click",(e=>{download_journey(e.target,d)}));$.fn.dataTable.ext.type.order["journey-time-pre"]=function(e){return Number(e.split(" 秒")[0])},$.fn.dataTable.ext.type.order["safety-score-pre"]=function(e){return Number(e.split(" 分")[0])},$("#table-demo").DataTable({lengthMenu:[[5,10,15,20],[5,10,15,20]],language:{lengthMenu:"顯示 _MENU_ 筆資料",sProcessing:"處理中...",sZeroRecords:"查無符合結果",sInfo:"目前有 _MAX_ 筆資料",sInfoEmpty:"目前共有 0 筆紀錄",sInfoFiltered:" ",sInfoPostFix:"",sSearch:"搜尋:",sUrl:"",sEmptyTable:"尚未有資料紀錄存在",sLoadingRecords:"載入資料中...",sInfoThousands:",",oPaginate:{sFirst:"首頁",sPrevious:"上一頁",sNext:"下一頁",sLast:"末頁"},order:[[0,"desc"]],oAria:{sSortAscending:": 以升序排列此列",sSortDescending:": 以降序排列此列"}},columnDefs:[{type:"journey-time",targets:4},{type:"safety-score",targets:5}]});var o=$(".dataTables_paginate ul.pagination").children().length;$(".dataTables_paginate ul.pagination").children()[o-2].click(),$(".loader-wrapper").fadeOut("slow")}}));