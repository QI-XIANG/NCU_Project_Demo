import{initializeApp}from"https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";import{getAnalytics}from"https://www.gstatic.com/firebasejs/9.8.3/firebase-analytics.js";import{switchChart,hideAllGraph,isNumeric,showdate,getCookie}from"./common_function.js";const firebaseConfig={apiKey:"AIzaSyDtTxfCIJIfPTEw44Ah5I1lpjiDO96FlJM",authDomain:"mydatabase-8f225.firebaseapp.com",databaseURL:"https://mydatabase-8f225-default-rtdb2.firebaseio.com",projectId:"mydatabase-8f225",storageBucket:"mydatabase-8f225.appspot.com",messagingSenderId:"68532714578",appId:"1:68532714578:web:fc038b336827906b65338b",measurementId:"G-68RXLWEXS7"};firebase.initializeApp(firebaseConfig,"db2");var db2=firebase.database(),CurrentPage=0,TotalPage=0,dates=[],journey_keys=[],avg_speed=[],avg_acceleration=[],avg_left_distance=[],avg_right_distance=[],avg_back_distance=[],accel_vio_count=[],speed_vio_count=[],LD_vio_count=[],RD_vio_count=[],BD_vio_count=[],safety_score=[];function chartGraph(e,t,a,o,r,c){var n=t.slice(0,1);if(e+1<TotalPage){var i=Number(10*e)+Number(1),s=10*e+11;n=n.concat(t.slice(i,s))}else{i=Number(10*e)+Number(1),s=t.length;n=n.concat(t.slice(i,s))}c3.generate({bindto:a,title:{show:!1,text:c,position:"top-center",padding:{top:20,right:20,bottom:40,left:50}},data:{type:"line",columns:[n]},axis:{x:{type:"category",categories:dates.slice(i-1,s-1),label:{text:"時間"},tick:{fit:!0}},y:{label:{text:o,position:"outer-middle"},min:0,tick:{count:5,format:d3.format(r)},padding:{bottom:0}}},size:{height:450,width:1024},padding:{bottom:15}})}function chartGraph_special(e,t){var a=avg_left_distance.slice(0,1),o=avg_right_distance.slice(0,1),r=avg_back_distance.slice(0,1);if(e+1<TotalPage)var c=Number(10*e)+Number(1),n=10*e+11;else c=Number(10*e)+Number(1),n=avg_left_distance.length;a=a.concat(avg_left_distance.slice(c,n)),o=o.concat(avg_right_distance.slice(c,n)),r=r.concat(avg_back_distance.slice(c,n));c3.generate({bindto:"#avg_distance_graph_dropdown #chart",title:{show:!1,text:t,position:"top-center",padding:{top:20,right:20,bottom:40,left:50}},data:{type:"line",columns:[a,r,o]},axis:{x:{type:"category",categories:dates.slice(c-1,n-1),label:{text:"時間"},tick:{fit:!0}},y:{label:{text:"單位 : mm",position:"outer-middle"},tick:{count:10,format:function(e){return parseInt(e)}},padding:{bottom:0},min:0}},size:{height:450,width:1024},padding:{bottom:15}})}function bar_chartGraph(e,t,a,o,r){var c=t.slice(0,1);if(e+1<TotalPage)var n=Number(10*e)+Number(1),i=10*e+11;else n=Number(10*e)+Number(1),i=t.length;c=c.concat(t.slice(n,i));c3.generate({bindto:a,title:{show:!1,text:r,position:"top-center",padding:{top:20,right:20,bottom:40,left:50}},data:{type:"bar",columns:[c]},bar:{width:{ratio:.5}},axis:{x:{type:"category",categories:dates.slice(n-1,i-1),label:{text:"時間"},tick:{fit:!0}},y:{label:{text:o,position:"outer-middle"}}},size:{height:450,width:1024},padding:{bottom:15}})}function bar_chartGraph_special(e,t){var a=LD_vio_count.slice(0,1),o=RD_vio_count.slice(0,1),r=BD_vio_count.slice(0,1);if(e+1<TotalPage)var c=Number(10*e)+Number(1),n=10*e+11;else c=Number(10*e)+Number(1),n=avg_left_distance.length;a=a.concat(LD_vio_count.slice(c,n)),o=o.concat(RD_vio_count.slice(c,n)),r=r.concat(BD_vio_count.slice(c,n));c3.generate({bindto:"#avg_distance_vio_count_graph_dropdown #chart",title:{show:!1,text:t,position:"top-center",padding:{top:20,right:20,bottom:40,left:50}},data:{type:"bar",columns:[a,o,r],groups:[["車距違規(左)","車距違規(右)","車距違規(後)"]]},axis:{x:{type:"category",categories:dates.slice(c-1,n-1),label:{text:"時間"},tick:{fit:!0}},y:{label:{text:"單位 : 次",position:"outer-middle"}}},size:{height:450,width:1024},padding:{bottom:15}})}avg_speed.push("平均速度"),avg_acceleration.push("平均加速度"),avg_left_distance.push("平均車距(左)"),avg_right_distance.push("平均車距(右)"),avg_back_distance.push("平均車距(後)"),accel_vio_count.push("加速度違規次數"),speed_vio_count.push("速度違規次數"),LD_vio_count.push("車距違規(左)"),RD_vio_count.push("車距違規(右)"),BD_vio_count.push("車距違規(後)"),safety_score.push("安全分數"),db2.ref("/Users/"+getCookie("uid")+"/journey").once("value",(function(e){var t=e.val();Object.keys(t).forEach((e=>{isNumeric(e)&&journey_keys.push(e)}));for(var a=0;a<journey_keys.length;a++)dates.push(showdate(new Date(1e3*t[journey_keys[a]].end_time))),avg_speed.push((100*t[journey_keys[a]].speed_stat.avg_speed/100).toFixed(2)),avg_acceleration.push((980*t[journey_keys[a]].acceleration_stat[0].avg_acceleration/100).toFixed(2)),avg_left_distance.push(t[journey_keys[a]].distance_stat[0].avg_distance),avg_right_distance.push(t[journey_keys[a]].distance_stat[1].avg_distance),avg_back_distance.push(t[journey_keys[a]].distance_stat[2].avg_distance),null!=t[journey_keys[a]].acceleration_stat[0].acceleration_violation&&accel_vio_count.push(Object.keys(t[journey_keys[a]].acceleration_stat[0].acceleration_violation).length),null==t[journey_keys[a]].acceleration_stat[0].acceleration_violation&&accel_vio_count.push(0),null!=t[journey_keys[a]].speed_stat.speed_violation&&speed_vio_count.push(Object.keys(t[journey_keys[a]].speed_stat.speed_violation).length),null==t[journey_keys[a]].speed_stat.speed_violation&&speed_vio_count.push(0),null!=t[journey_keys[a]].distance_stat[0].distance_violation&&LD_vio_count.push(Object.keys(t[journey_keys[a]].distance_stat[0].distance_violation).length),null==t[journey_keys[a]].distance_stat[0].distance_violation&&LD_vio_count.push(0),null!=t[journey_keys[a]].distance_stat[1].distance_violation&&RD_vio_count.push(Object.keys(t[journey_keys[a]].distance_stat[1].distance_violation).length),null==t[journey_keys[a]].distance_stat[1].distance_violation&&RD_vio_count.push(0),null!=t[journey_keys[a]].distance_stat[2].distance_violation&&BD_vio_count.push(Object.keys(t[journey_keys[a]].distance_stat[2].distance_violation).length),null==t[journey_keys[a]].distance_stat[2].distance_violation&&BD_vio_count.push(0),null!=t[journey_keys[a]].safety_score&&safety_score.push(t[journey_keys[a]].safety_score),null==t[journey_keys[a]].safety_score&&safety_score.push(0);(avg_speed.length-1)%10==0&&(TotalPage=Math.round(avg_speed.length/10)),(avg_speed.length-1)%10!=0&&(TotalPage=Math.ceil(avg_speed.length/10)),document.querySelector(".nextBtn").addEventListener("click",(e=>{CurrentPage+1<TotalPage&&(CurrentPage+=1),chartGraph(CurrentPage,avg_speed,"#avg_speed_graph_dropdown #chart","單位 : km/hr",".2f","行車平均速度折線圖"),chartGraph(CurrentPage,safety_score,"#safety_score_graph_dropdown #chart","單位 : 分",".1f","行車安全分數折線圖"),chartGraph(CurrentPage,avg_acceleration,"#avg_acceleration_graph_dropdown #chart","單位 : m/s²",".3f","行車平均加速度折線圖"),chartGraph_special(CurrentPage,"行車平均車距折線圖"),bar_chartGraph(CurrentPage,accel_vio_count,"#avg_acceleration_vio_count_graph_dropdown #chart","單位 : 次","行車加速度違規長條圖"),bar_chartGraph(CurrentPage,speed_vio_count,"#avg_speed_vio_count_graph_dropdown #chart","單位 : 次","行車速度違規長條圖"),bar_chartGraph_special(CurrentPage,"行車車距違規次數長條圖")})),document.querySelector(".lastBtn").addEventListener("click",(e=>{CurrentPage-1>=0&&(CurrentPage-=1),chartGraph(CurrentPage,avg_speed,"#avg_speed_graph_dropdown #chart","單位 : km/hr",".2f","行車平均速度折線圖"),chartGraph(CurrentPage,safety_score,"#safety_score_graph_dropdown #chart","單位 : 分",".1f","行車安全分數折線圖"),chartGraph(CurrentPage,avg_acceleration,"#avg_acceleration_graph_dropdown #chart","單位 : m/s²",".3f","行車平均加速度折線圖"),chartGraph_special(CurrentPage,"行車平均車距折線圖"),bar_chartGraph(CurrentPage,accel_vio_count,"#avg_acceleration_vio_count_graph_dropdown #chart","單位 : 次","行車加速度違規長條圖"),bar_chartGraph(CurrentPage,speed_vio_count,"#avg_speed_vio_count_graph_dropdown #chart","單位 : 次","行車速度違規長條圖"),bar_chartGraph_special(CurrentPage,"行車車距違規次數長條圖")})),chartGraph(CurrentPage=TotalPage-1,avg_speed,"#avg_speed_graph_dropdown #chart","單位 : km/hr",".2f","行車平均速度折線圖"),chartGraph(CurrentPage,safety_score,"#safety_score_graph_dropdown #chart","單位 : 分",".1f","行車安全分數折線圖"),chartGraph(CurrentPage,avg_acceleration,"#avg_acceleration_graph_dropdown #chart","單位 : m/s²",".3f","行車平均加速度折線圖"),chartGraph_special(CurrentPage,"行車平均車距折線圖"),bar_chartGraph(CurrentPage,accel_vio_count,"#avg_acceleration_vio_count_graph_dropdown #chart","單位 : 次","行車加速度違規長條圖"),bar_chartGraph(CurrentPage,speed_vio_count,"#avg_speed_vio_count_graph_dropdown #chart","單位 : 次","行車速度違規長條圖"),bar_chartGraph_special(CurrentPage,"行車車距違規次數長條圖"),switchChart(),hideAllGraph(),$("#avg_speed_graph_dropdown #chart").fadeIn(500)})),document.querySelector(".dropdownContainer").addEventListener("click",(e=>{$(".dropdownContainer a").css("background-color","white")})),$((function(){$('[data-toggle2="tooltip"]').tooltip()}));